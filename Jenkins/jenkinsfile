#!/usr/bin/env groovy

node {
    stage('prime'){
        def status = powershell(returnStatus: true, script: 'Write-Output "Hello, World!"')
		if ( status == 0){
			echo 'Hello world ok'
		}
        def status1 = powershell(returnStatus: true, script: 'Copy-Item c:\sites\configdata\timepuncher-client-config-timepuncher.ch.ts '$env:TP_WORKSPACE'%TP_WORKSPACE%\TpMaterial\src\app\timepuncher-client-config.ts')
		if ( status1 == 0){
			echo 'Copy ok'
		}
    }
    stage('prepare'){
        git changelog: false, poll: false, url: 'C:\\sites\\Bonobo.Git.Server\\App_Data\\Repositories\\Tp'    
        
    }
    stage('install'){
        dir('TpMaterial') {
            bat 'npm install'
        }
        dir('TpDotNetCore') {
            bat 'dotnet restore'
        }
        dir('TpIonic') {
            bat 'npm install'
        }
    }
    stage('build'){
        dir('TpMaterial'){
            bat 'ng build --prod'
        }
        dir('TpDotNetCire'){
            bat 'dotnet run'
        }
    }
}